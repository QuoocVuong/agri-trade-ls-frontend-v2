<!-- Sử dụng card của DaisyUI -->
<div class="card card-compact bg-base-100 shadow-md hover:shadow-lg transition-shadow duration-300 h-full flex flex-col">
  <!-- Link bao quanh ảnh và tiêu đề -->
  <a [routerLink]="['/products', product.slug]">
    <figure class="relative aspect-square overflow-hidden">
      <img [src]="product.thumbnailUrl || 'assets/images/placeholder-image.png'"
           [alt]="product.name"
           class="w-full h-full object-cover transition-transform duration-300 hover:scale-105" />
      <!-- Có thể thêm badge giảm giá, mới... ở góc ảnh -->
      <!-- <div class="badge badge-secondary absolute top-2 right-2 badge-sm">Mới</div> -->
    </figure>
  </a>
  <div class="card-body flex-grow flex flex-col justify-between p-3 md:p-4">
    <div>
      <!-- Link đến trang farmer -->
      <a [routerLink]="['/farmer', product.farmerInfo?.farmerId]" class="text-xs text-base-content/70 hover:text-primary mb-1 block truncate">
        {{ product.farmerInfo?.farmName || 'Nông dân ẩn danh' }}
      </a>
      <!-- Link đến chi tiết sản phẩm -->
      <a [routerLink]="['/products', product.slug]" class="hover:text-primary">
        <h2 class="card-title text-sm md:text-base font-semibold leading-snug mb-2 h-12 md:h-14 overflow-hidden"> <!-- Giới hạn 2 dòng -->
          {{ product.name }}
        </h2>
      </a>
      <!-- Rating (ví dụ) -->
      <div class="flex items-center text-xs mb-2" *ngIf="product.averageRating && product.averageRating > 0">
        <svg *ngFor="let i of [1,2,3,4,5]" class="w-3 h-3 fill-current" [ngClass]="i <= product.averageRating ? 'text-warning' : 'text-base-300'" viewBox="0 0 24 24"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>
        <span class="ml-1 text-base-content/70">({{ product.averageRating | number:'1.1-1' }})</span>
      </div>
    </div>

    <!-- Giá và nút bấm -->
    <div class="card-actions items-center justify-between mt-2">
      <div class="flex flex-col">
         <span class="text-primary font-bold text-sm md:text-base">
           {{ product.price | formatBigDecimal:'1.0-0' }} đ <!-- Format tiền tệ -->
         </span>
        <span class="text-xs text-base-content/70">/ {{ product.unit }}</span>
      </div>
      <div class="flex items-center space-x-1">
        <!-- Nút yêu thích -->
        <button class="btn btn-ghost btn-xs btn-circle"
                title="Thêm vào yêu thích"
                (click)="toggleFavorite($event)"
                [disabled]="isTogglingFavorite()">
          <span *ngIf="isTogglingFavorite()" class="loading loading-spinner loading-xs"></span>
          <!-- Thay đổi icon dựa trên trạng thái isFavorite -->
          <svg *ngIf="!isTogglingFavorite()" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" [ngClass]="{'fill-error text-error': false}" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
        </button>
        <!-- Nút thêm vào giỏ -->
        <button class="btn btn-primary btn-xs"
                (click)="addToCart($event)"
                [disabled]="isAddingToCart()">
          <span *ngIf="isAddingToCart()" class="loading loading-spinner loading-xs"></span>
          <svg *ngIf="!isAddingToCart()" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
          <!-- <span class="hidden sm:inline ml-1">Thêm</span> -->
        </button>
      </div>
    </div>
  </div>
</div>
