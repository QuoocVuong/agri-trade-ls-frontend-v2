<div> <!-- Container cho list review -->
  <!-- Loading / Error / Empty -->
  <div *ngIf="isLoading()" class="text-center py-5"><app-loading-spinner></app-loading-spinner></div>
  <app-alert *ngIf="errorMessage()" type="error" [message]="errorMessage()"></app-alert>
  <div *ngIf="!isLoading() && (!reviewsPage() || (reviewsPage()?.content?.length ?? 0) === 0) && !errorMessage()" class="text-center py-5 text-base-content/60">
    <span *ngIf="mode === 'product'">Chưa có đánh giá nào cho sản phẩm này.</span>
    <span *ngIf="mode === 'my'">Bạn chưa viết đánh giá nào.</span>
    <span *ngIf="mode === 'admin_pending'">Không có đánh giá nào đang chờ duyệt.</span>
  </div>

  <!-- Review List -->
  <div *ngIf="!isLoading() && reviewsPage() && reviewsPage()!.content.length > 0" class="space-y-4">
    <div *ngFor="let review of reviewsPage()?.content; trackBy: trackReviewById" class="border-b border-base-300 pb-4 last:border-b-0 last:pb-0">
      <div class="flex items-start space-x-3">
        <!-- Avatar -->
        <div class="avatar flex-shrink-0">
          <div class="w-10 h-10 rounded-full">
            <img [src]="review.consumer?.avatarUrl || 'assets/images/default-avatar.png'" [alt]="review.consumer?.fullName || 'User'">
          </div>
        </div>
        <!-- Review Content -->
        <div class="flex-grow">
          <div class="flex items-center justify-between mb-1">
            <span class="font-semibold text-sm">{{ review.consumer?.fullName || 'Người dùng ẩn danh' }}</span>
            <!-- Rating Stars -->
            <div class="flex items-center text-xs">
              <svg *ngFor="let i of [1,2,3,4,5]" class="w-3 h-3 fill-current" [ngClass]="i <= review.rating ? 'text-warning' : 'text-base-300'" viewBox="0 0 24 24"><path d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z"/></svg>
            </div>
          </div>
          <p *ngIf="review.comment" class="text-sm text-base-content/90 mb-1">{{ review.comment }}</p>
          <p class="text-xs text-base-content/60">{{ review.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>

          <!-- Admin Actions -->
          <div *ngIf="mode === 'admin_pending'" class="mt-2 space-x-2">
            <button class="btn btn-xs btn-success" (click)="approveReview(review.id)">Duyệt</button>
            <button class="btn btn-xs btn-error" (click)="rejectReview(review.id)">Từ chối</button>
            <button class="btn btn-xs btn-ghost text-error" (click)="deleteReview(review.id)">Xóa</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="reviewsPage() && reviewsPage()!.totalPages > 1" class="mt-6 flex justify-center">
    <app-paginator
      [currentPage]="reviewsPage()!.number"
      [totalPages]="reviewsPage()!.totalPages"
      (pageChange)="onPageChange($event)">
    </app-paginator>
  </div>

</div>
