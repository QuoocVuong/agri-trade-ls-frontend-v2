<div class="container mx-auto px-4 py-6 md:py-8 lg:py-10 max-w-5xl">
  <!-- Header -->
  <h1 class="text-2xl md:text-3xl font-bold mb-6 text-primary">Thông tin tài khoản</h1>

  <!-- Loading -->
  <div *ngIf="isLoading()" class="flex justify-center py-12">
    <span class="loading loading-spinner loading-lg text-primary"></span>
  </div>

  <!-- Error -->
  <app-alert *ngIf="errorMessage() && !isLoading()" type="error" [message]="errorMessage()" class="mb-6 animate-fade-in"></app-alert>

  <!-- Profile Details -->
  <div *ngIf="profile() && !isLoading()" class="card shadow-lg rounded-lg lg:card-side overflow-hidden animate-slide-in">
    <!-- Avatar Section -->
    <figure class="p-6 flex justify-center lg:w-1/4 ">
      <div class="avatar">
        <div class="w-32 lg:w-36 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 transition-transform hover:scale-105">
          <img [src]="profile()?.avatarUrl || 'assets/images/default-avatar.png'" [alt]="profile()?.fullName || 'Avatar'" />
        </div>
      </div>
    </figure>

    <!-- Info Section -->
    <div class="card-body lg:w-3/4 p-6 md:p-8">
      <div class="flex flex-col sm:flex-row justify-between items-start gap-4 mb-6">
        <div>
          <h2 class="card-title text-2xl font-semibold" [textContent]="profile()?.fullName"></h2>
          <p class="text-sm text-base-content/70 mt-1" [textContent]="profile()?.email"></p>
          <p class="text-sm text-base-content/70 mt-1">
            Số điện thoại: <span [textContent]="profile()?.phoneNumber || 'Chưa cập nhật'"></span>
          </p>
          <p class="text-sm text-base-content/70 mt-1">
            Ngày tham gia: <span [textContent]="profile()?.createdAt | date:'dd/MM/yyyy'"></span>
          </p>
          <div class="mt-3 flex items-center gap-2">
            <span class="text-sm font-medium">Vai trò:</span>
            <span *ngFor="let role of profile()?.roles" class="badge badge-primary badge-outline text-xs">
              {{ role.replace('ROLE_', '') }}
            </span>
          </div>
        </div>
        <!-- Actions -->
        <div class="mt-4 sm:mt-0 flex flex-col sm:flex-row gap-2">
          <a
            routerLink="/user/profile/edit"
            class="btn btn-sm btn-primary btn-outline w-full sm:w-auto hover:bg-primary/10 transition-colors"
            aria-label="Chỉnh sửa thông tin cá nhân">
            Chỉnh sửa
          </a>
          <a
            routerLink="/user/profile/change-password"
            class="btn btn-sm btn-outline w-full sm:w-auto hover:bg-base-300 transition-colors"
            aria-label="Đổi mật khẩu">
            Đổi mật khẩu
          </a>
        </div>
      </div>

      <!-- Farmer Profile -->
      <div *ngIf="profile()?.farmerProfile as farmerProfile" class="mt-6 pt-6 border-t border-base-300">
        <h3 class="text-lg font-semibold mb-3">Thông tin Nông dân</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
          <div>
            <p class="text-base-content/70">Tên gian hàng:</p>
            <p class="font-medium">{{ farmerProfile.farmName || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Địa chỉ:</p>
            <p class="font-medium">
              {{ farmerProfile.addressDetail || 'Chưa cập nhật' }}
              <ng-container *ngIf="farmerProfile.addressDetail">
                <span *ngIf="wardName()">, {{ wardName() }}</span>
                <span *ngIf="districtName()">, {{ districtName() }}</span>
                <span *ngIf="provinceName()">, {{ provinceName() }}</span>
              </ng-container>
            </p>
          </div>
          <div>
            <p class="text-base-content/70">Tỉnh/Thành (Mã):</p>
            <p class="font-medium">{{ farmerProfile.provinceCode || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Trạng thái hồ sơ:</p>
            <!-- Sử dụng verificationStatus từ farmerProfile -->
            <p class="font-medium">{{ getVerificationStatusText(farmerProfile.verificationStatus) || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Mô tả gian hàng:</p>
            <p class="font-medium whitespace-pre-wrap">{{ farmerProfile.description || 'Chưa cập nhật' }}</p>
          </div>

          <!-- Hiển thị các trường từ User (nếu bạn muốn lấy từ farmerProfile thay vì profile()) -->
          <!-- Tuy nhiên, profile() đã có các thông tin này do kế thừa UserResponse -->
<!--           Ví dụ:-->
          <div>
            <p class="text-base-content/70">Họ tên (Nông dân):</p>
            <p class="font-medium">{{ farmerProfile.fullName || profile()?.fullName || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Số điện thoại (Nông dân):</p>
            <p class="font-medium">{{ farmerProfile.phoneNumber || profile()?.phoneNumber || 'Chưa cập nhật' }}</p>
          </div>

          <div *ngIf="farmerProfile.canSupplyB2b">
            <p class="text-base-content/70">Có cung cấp B2B:</p>
            <p class="font-medium">Có</p>
          </div>
          <div *ngIf="farmerProfile.canSupplyB2b">
            <p class="text-base-content/70">Chứng nhận B2B:</p>
            <p class="font-medium">{{ farmerProfile.b2bCertifications || 'Chưa cập nhật' }}</p>
          </div>
          <div *ngIf="farmerProfile.canSupplyB2b && farmerProfile.minB2bOrderValue">
            <p class="text-base-content/70">Giá trị đơn hàng B2B tối thiểu:</p>
            <p class="font-medium">{{ farmerProfile.minB2bOrderValue | formatBigDecimal }}</p> <!-- Giả sử là số -->
          </div>

          <div>
            <p class="text-base-content/70">Ngày xác minh:</p>
            <p class="font-medium">
              {{ farmerProfile.verifiedAt ? (farmerProfile.verifiedAt | date:'dd/MM/yyyy HH:mm') : 'Chưa xác minh' }}
            </p>
          </div>
          <div *ngIf="farmerProfile.verifiedByAdminName">
            <p class="text-base-content/70">Người duyệt:</p>
            <p class="font-medium">{{ farmerProfile.verifiedByAdminName }}</p>
          </div>

        </div>
        <div class="mt-4 flex flex-col sm:flex-row gap-2">
          <a
            routerLink="/user/profile/farmer-profile"
            class="btn btn-sm btn-link text-primary hover:text-primary-dark transition-colors"
            aria-label="Xem hoặc sửa hồ sơ nông dân">
            Xem/Sửa hồ sơ Nông dân
          </a>
          <a
            routerLink="/farmer/dashboard"
            class="btn btn-sm btn-link text-primary hover:text-primary-dark transition-colors"
            aria-label="Vào kênh người bán">
            Vào Kênh người bán
          </a>
        </div>
      </div>

      <!-- Business Profile -->
      <!-- Business Profile -->
      <div *ngIf="profile()?.businessProfile as businessProfile" class="mt-6 pt-6 border-t border-base-300">
        <h3 class="text-lg font-semibold mb-3">Thông tin Doanh nghiệp</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
          <div>
            <p class="text-base-content/70">Tên doanh nghiệp:</p>
            <!-- SỬA Ở ĐÂY: Sử dụng businessName -->
            <p class="font-medium">{{ businessProfile.businessName || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Mã số thuế:</p>
            <p class="font-medium">{{ businessProfile.taxCode || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Địa chỉ:</p>
            <p class="font-medium">
              {{ businessProfile.businessAddressDetail || 'Chưa cập nhật' }}
              <ng-container *ngIf="businessProfile.businessAddressDetail">
                <!-- Gọi các hàm lấy tên xã/phường, quận/huyện, tỉnh/thành nếu có và cần thiết -->
                <!-- Giả sử bạn đã có các hàm này trong component hoặc LocationService -->
                <span *ngIf="businessProfile.wardCode && getWardName(businessProfile.wardCode)">, {{ getWardName(businessProfile.wardCode) }}</span>
                <span *ngIf="businessProfile.districtCode && getDistrictName(businessProfile.districtCode)">, {{ getDistrictName(businessProfile.districtCode) }}</span>
                <span *ngIf="businessProfile.businessProvinceCode && getProvinceName(businessProfile.businessProvinceCode)">, {{ getProvinceName(businessProfile.businessProvinceCode) }}</span>
              </ng-container>
            </p>
          </div>
          <div>
            <p class="text-base-content/70">Ngành nghề:</p>
            <p class="font-medium">{{ businessProfile.industry || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Số điện thoại DN:</p>
            <p class="font-medium">{{ businessProfile.businessPhone || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Người liên hệ:</p>
            <p class="font-medium">{{ businessProfile.contactPerson || 'Chưa cập nhật' }}</p>
          </div>
          <div>
            <p class="text-base-content/70">Ngày đăng ký:</p>
            <p class="font-medium">{{ businessProfile.createdAt ? (businessProfile.createdAt | date:'dd/MM/yyyy HH:mm') : 'Chưa cập nhật' }}</p>

          </div>
          <div>
            <p class="text-base-content/70">Trạng thái hồ sơ:</p>
            <!-- Trường status không có trong JSON, bạn có thể bỏ qua hoặc hiển thị mặc định -->
            <p class="font-medium">{{ businessProfile.status || 'Đã Duyệt' }}</p>
          </div>
        </div>
        <div class="mt-4">
          <a
            routerLink="/user/profile/business-profile"
          class="btn btn-sm btn-link text-primary hover:text-primary-dark transition-colors"
          aria-label="Xem hoặc sửa hồ sơ doanh nghiệp">
          Xem/Sửa hồ sơ Doanh nghiệp
          </a>
        </div>
      </div>

      <!-- Register Links -->
      <div *ngIf="isConsumerOnly()" class="mt-8 pt-8 border-t border-base-300 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="card shadow-md rounded-lg p-5 hover:shadow-lg transition-shadow">
          <h3 class="font-semibold text-base mb-2">Bạn là Nông dân?</h3>
          <p class="text-sm text-base-content/70 mb-4">Đăng ký gian hàng để bán nông sản của bạn.</p>
          <a
            routerLink="/user/profile/farmer-profile"
            class="btn btn-sm btn-success w-full md:w-auto"
            aria-label="Đăng ký bán hàng nông dân">
            Đăng ký bán hàng
          </a>
        </div>
        <div class="card shadow-md rounded-lg p-5 hover:shadow-lg transition-shadow">
          <h3 class="font-semibold text-base mb-2">Mua hàng cho Doanh nghiệp?</h3>
          <p class="text-sm text-base-content/70 mb-4">Đăng ký tài khoản B2B để nhận ưu đãi.</p>
          <a
            routerLink="/user/profile/business-profile"
            class="btn btn-sm btn-info w-full md:w-auto"
            aria-label="Đăng ký tài khoản doanh nghiệp">
            Đăng ký Doanh nghiệp
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes slide-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in {
    animation: fade-in 0.3s ease-out;
  }
  .animate-slide-in {
    animation: slide-in 0.3s ease-out;
  }
</style>
