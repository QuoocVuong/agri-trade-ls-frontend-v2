<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Thông báo của bạn</h1>
    <button class="btn btn-sm btn-ghost text-primary"
            (click)="markAllAsRead()"
            [disabled]="unreadCount() === 0"> <!-- Disable nếu không có unread -->
      <i class="fas fa-check-double mr-1"></i> Đánh dấu tất cả đã đọc
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="text-center py-20">
    <app-loading-spinner size="lg"></app-loading-spinner>
  </div>

  <!-- Error State -->
  <app-alert *ngIf="errorMessage() && !isLoading()" type="error" [message]="errorMessage()"></app-alert>

  <!-- Notification List -->
  <div *ngIf="!isLoading() && (notificationsPage()?.content?.length ?? 0) > 0" class="space-y-3">
    <div *ngFor="let notification of notificationsPage()?.content; trackBy: trackNotificationById"
         class="card card-compact shadow border border-base-300/50 hover:shadow-md transition-shadow group">
      <div class="card-body">
        <!-- *** SỬA LẠI CẤU TRÚC DIV VÀ A *** -->
        <div class="flex items-start gap-4">
          <!-- Icon -->
          <div class="flex-shrink-0 w-8 text-center pt-1 text-xl"
               [ngClass]="notification.isRead ? 'text-base-content/40' : 'text-primary'">
            <i [class]="getIcon(notification.type)"></i>
          </div>

          <!-- Thẻ <a> bao quanh nội dung chính và có các binding -->
          <a class="flex-grow group-hover:text-primary transition-colors cursor-pointer"
             (click)="markAsReadAndNavigate(notification)"
             [href]="notification.link || '#'"
             [target]="notification.link ? '_self' : null">

            <p class="text-base leading-relaxed"
               [ngClass]="{'font-semibold': !notification.isRead}"
               [innerHTML]="notification.message | safeHtml">
            </p>
            <p class="text-sm text-base-content/60 mt-1">
              {{ notification.createdAt | timeAgo }}
              <span *ngIf="!notification.isRead" class="inline-block w-2 h-2 bg-primary rounded-full ml-2" title="Chưa đọc"></span>
            </p>
          </a> <!-- Kết thúc thẻ <a> -->

          <!-- Actions (Nút xóa) - Nằm cùng cấp với Icon và thẻ <a> nội dung -->
          <div class="card-actions justify-end ml-auto opacity-0 group-hover:opacity-100 transition-opacity">
            <button class="btn btn-xs btn-ghost text-error p-1"
                    title="Xóa thông báo"
                    (click)="deleteNotification(notification.id, $event)"
                    [disabled]="deletingNotificationId() === notification.id">
              <span *ngIf="deletingNotificationId() === notification.id" class="loading loading-spinner loading-xs"></span>
              <svg *ngIf="deletingNotificationId() !== notification.id" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
            </button>
          </div>
        </div> <!-- Kết thúc div.flex -->
      </div> <!-- Kết thúc div.card-body -->
    </div> <!-- Kết thúc div *ngFor -->
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && (!notificationsPage() || (notificationsPage()?.content?.length ?? 0) === 0) && !errorMessage()"
       class="text-center py-20 px-4 border border-dashed rounded-lg">
    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-base-content/20" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341A6.002 6.002 0 006 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
    <p class="mt-4 text-xl font-medium text-base-content/70">Không có thông báo nào.</p>
  </div>

  <!-- Pagination -->
  <div *ngIf="notificationsPage() && notificationsPage()!.totalPages > 1" class="mt-8 flex justify-center">
    <app-paginator
      [currentPage]="notificationsPage()!.number"
      [totalPages]="notificationsPage()!.totalPages"
      (pageChange)="onPageChange($event)">
    </app-paginator>
  </div>

</div>
