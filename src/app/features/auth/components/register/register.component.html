<h2 class="card-title justify-center text-2xl mb-4">Đăng ký tài khoản</h2>

<!-- Success/Error Messages -->
<div *ngIf="successMessage()" class="alert alert-success shadow-sm mb-4 text-sm p-2"><span>{{ successMessage() }}</span></div>
<div *ngIf="errorMessage()" class="alert alert-error shadow-sm mb-4 text-sm p-2 whitespace-pre-line"><span>{{ errorMessage() }}</span></div>


<form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="w-full space-y-1"> <!-- Giảm space-y -->
  <!-- Full Name -->
  <div class="form-control w-full">
    <label class="label py-1"><span class="label-text text-xs font-medium">Họ và tên <span class="text-error">*</span></span></label>
    <input type="text" placeholder="Nhập họ tên" class="input input-bordered w-full input-sm"
           formControlName="fullName"
           [ngClass]="{'input-error': registerForm.controls['fullName'].invalid && registerForm.controls['fullName'].touched}" />
    <label class="label py-0 h-4" *ngIf="registerForm.controls['fullName'].invalid && registerForm.controls['fullName'].touched">
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['fullName'].errors?.['required']">Họ tên là bắt buộc.</span>
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['fullName'].errors?.['maxlength']">Họ tên quá dài (tối đa 100 ký tự).</span>
    </label>
  </div>

  <!-- Email -->
  <div class="form-control w-full">
    <label class="label py-1"><span class="label-text text-xs font-medium">Email <span class="text-error">*</span></span></label>
    <input type="email" placeholder="Nhập email" class="input input-bordered w-full input-sm"
           formControlName="email"
           [ngClass]="{'input-error': registerForm.controls['email'].invalid && registerForm.controls['email'].touched}" />
    <label class="label py-0 h-4" *ngIf="registerForm.controls['email'].invalid && registerForm.controls['email'].touched">
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['email'].errors?.['required']">Email là bắt buộc.</span>
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['email'].errors?.['email']">Email không đúng định dạng.</span>
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['email'].errors?.['maxlength']">Email quá dài.</span>
    </label>
  </div>

  <!-- Phone Number -->
  <div class="form-control w-full">
    <label class="label py-1"><span class="label-text text-xs font-medium">Số điện thoại (Tùy chọn)</span></label>
    <input type="tel" placeholder="Nhập số điện thoại" class="input input-bordered w-full input-sm"
           formControlName="phoneNumber"
           [ngClass]="{'input-error': registerForm.controls['phoneNumber'].invalid && registerForm.controls['phoneNumber'].touched}" />
    <label class="label py-0 h-4"
           *ngIf="registerForm.controls['phoneNumber'].touched && registerForm.controls['phoneNumber'].value">
  <span class="label-text-alt text-error text-xs"
        *ngIf="registerForm.controls['phoneNumber'].errors?.['maxlength']">Số điện thoại quá dài.</span>
      <span class="label-text-alt text-error text-xs"
            *ngIf="registerForm.controls['phoneNumber'].errors?.['pattern']">Số điện thoại không hợp lệ.</span>
    </label>
  </div>

  <!-- Password -->
  <div class="form-control w-full">
    <label class="label py-1"><span class="label-text text-xs font-medium">Mật khẩu <span class="text-error">*</span></span></label>
    <input type="password" placeholder="Nhập mật khẩu (ít nhất 6 ký tự)" class="input input-bordered w-full input-sm"
           formControlName="password"
           [ngClass]="{'input-error': registerForm.controls['password'].invalid && registerForm.controls['password'].touched}" />
    <label class="label py-0 h-4" *ngIf="registerForm.controls['password'].invalid && registerForm.controls['password'].touched">
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['password'].errors?.['required']">Mật khẩu là bắt buộc.</span>
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['password'].errors?.['minlength'] || registerForm.controls['password'].errors?.['maxlength']">Mật khẩu phải từ 6-100 ký tự.</span>
    </label>
  </div>

  <!-- Confirm Password -->
  <div class="form-control w-full">
    <label class="label py-1"><span class="label-text text-xs font-medium">Xác nhận mật khẩu <span class="text-error">*</span></span></label>
    <input type="password" placeholder="Nhập lại mật khẩu" class="input input-bordered w-full input-sm"
           formControlName="confirmPassword"
           [ngClass]="{'input-error': registerForm.controls['confirmPassword'].invalid && registerForm.controls['confirmPassword'].touched || registerForm.hasError('passwordMismatch') && registerForm.controls['confirmPassword'].touched}" />
    <label class="label py-0 h-4" *ngIf="(registerForm.controls['confirmPassword'].invalid || registerForm.hasError('passwordMismatch')) && registerForm.controls['confirmPassword'].touched">
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.controls['confirmPassword'].errors?.['required']">Vui lòng xác nhận mật khẩu.</span>
      <span class="label-text-alt text-error text-xs" *ngIf="registerForm.hasError('passwordMismatch')">Mật khẩu xác nhận không khớp.</span>
    </label>
  </div>

  <div class="form-control pt-4">
    <button type="submit" class="btn btn-primary btn-sm" [disabled]="isLoading() || registerForm.invalid">
      <span *ngIf="isLoading()" class="loading loading-spinner loading-xs"></span>
      {{ isLoading() ? 'Đang xử lý...' : 'Đăng ký' }}
    </button>
  </div>

  <div class="divider text-xs">Đã có tài khoản?</div>
  <a routerLink="/auth/login" class="btn btn-outline btn-sm w-full">Đăng nhập</a>
</form>
